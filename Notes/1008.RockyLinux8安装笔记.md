---
title: "Rocky Linux 8 å®‰è£…ç¬”è®°"
---

> æ‘˜è‡ªï¼š[Rocky Linux 8 å®‰è£…ç¬”è®°][link001]ï¼Œç‚¹å‡»æŸ¥çœ‹æœ€æ–°ç‰ˆã€‚
>
> > ä½œè€…ï¼šgc(at)sysin.orgï¼Œä¸»é¡µï¼šwww.sysin.org

# ğŸš€ æ ¼å¼åŒ–ç½‘å¡å‘½å

å³ç¦ç”¨ consistent interface device naming

**è¦ç‚¹ï¼šä¸ CentOS 7 é…ç½®ä¸Šç•¥æœ‰ä¸åŒã€‚**

- CentOS 7ï¼šnet.ifnames=0 biosdevname=0
- CentOS 8ï¼šnet.ifnames=0

  ```bash
  [root@localhost ~]# cd /etc/sysconfig/network-scripts/
  [root@localhost ~]# ls
  ifcfg-ens33
  ```

  æ³¨æ„è¿™é‡Œçš„åç§°æ ¹æ®ç¡¬ä»¶æœ‰æ‰€å˜åŠ¨ï¼Œæœ¬ä¾‹ä¸ºè¿è¡Œåœ¨ VMware Fusion ä¸­çš„è™šæ‹Ÿæœºï¼Œ
  ç½‘å¡é»˜è®¤åç§°ä¸º ens33ï¼Œå¦‚æœä½ å¸Œæœ›ç»§ç»­ä½¿ç”¨ eth0 è¿™æ ·çš„ä¼ ç»Ÿåç§°ï¼Œ
  é‚£ä¹ˆåœ¨å®‰è£…å¯åŠ¨æ—¶åŠ ä¸Šå‚æ•°ï¼š`net.ifnames=0`

  > è¿™ç§å˜åŒ–çš„åŸå› ï¼Œä» CentOS 7 å¼€å§‹ï¼Œæ˜¯ç”±äº systemd å’Œ udev
  > å¼•å…¥äº†ä¸€ç§æ–°çš„ç½‘ç»œè®¾å¤‡å‘½åæ–¹å¼ â€“ ä¸€è‡´ç½‘ç»œè®¾å¤‡å‘½å
  > ï¼ˆCONSISTENT NETWORK DEVICE NAMINGï¼‰ã€‚
  > å¯ä»¥æ ¹æ®å›ºä»¶ã€æ‹“æ‰‘ã€ä½ç½®ä¿¡æ¯æ¥è®¾ç½®å›ºå®šåå­—ï¼Œå¸¦æ¥çš„å¥½å¤„æ˜¯å‘½åè‡ªåŠ¨åŒ–ï¼Œ
  > åå­—å®Œå…¨å¯é¢„æµ‹ï¼Œåœ¨ç¡¬ä»¶åäº†ä»¥åæ›´æ¢ä¹Ÿä¸ä¼šå½±å“è®¾å¤‡çš„å‘½åï¼Œ
  > è¿™æ ·å¯ä»¥è®©ç¡¬ä»¶çš„æ›´æ¢æ— ç¼åŒ–ã€‚å¸¦æ¥çš„ä¸åˆ©æ˜¯æ–°çš„è®¾å¤‡åç§°æ¯”ä¼ ç»Ÿçš„åç§°éš¾ä»¥é˜…è¯»ã€‚
  > æ¯”å¦‚æ–°çš„åç§°æ˜¯ enp5s0.

Rocky Linux 8 grub é»˜è®¤é…ç½®å¦‚ä¸‹:

```bash
# cat /etc/default/grub
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR="$(sed's, release .*$,,g'/etc/system-release)"
GRUB_DEFAULT=saved
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto resume=/dev/mapper/rl-swap rd.lvm.lv=rl/root rd.lvm.lv=rl/swap"
GRUB_DISABLE_RECOVERY="true"
GRUB_ENABLE_BLSCFG=true

## ä»¥ä¸Šæ˜¯ LVM åˆ†åŒºï¼Œå¦‚æœæ˜¯æ ‡å‡†åˆ†åŒºï¼Œä½¿ç”¨çš„æ˜¯ swap åˆ†åŒºçš„ UUID
GRUB_CMDLINE_LINUX="crashkernel=auto resume=UUID=9c19ee14-b1a5-4c30-a9ca-7efc6c190dc7"
```

ä¸åŒäº CentOS 8ï¼Œæ²¡æœ‰ `rhgb quiet`

> rhgb è¡¨ç¤º redhat graphics bootï¼Œå°±æ˜¯ä¼šçœ‹åˆ°å›¾ç‰‡æ¥ä»£æ›¿å¯åŠ¨è¿‡ç¨‹ä¸­æ˜¾ç¤ºçš„æ–‡æœ¬ä¿¡æ¯ï¼Œ
> è¿™äº›ä¿¡æ¯åœ¨å¯åŠ¨åç”¨ dmesg ä¹Ÿå¯ä»¥çœ‹åˆ°ã€‚
>
> quiet è¡¨ç¤ºåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­åªæœ‰é‡è¦ä¿¡æ¯æ˜¾ç¤ºï¼Œç±»ä¼¼ç¡¬ä»¶è‡ªæ£€çš„æ¶ˆæ¯ä¸å›æ˜¾ç¤ºã€‚

1. ç¼–è¾‘ grub é…ç½®æ–‡ä»¶

   ```text
    # å¦‚æœç³»ç»Ÿå·²ç»å®‰è£…ï¼Œå¸Œæœ›æ”¹æˆ eth0 è¿™æ ·çš„åç§°ï¼Œé‚£ä¹ˆéœ€è¦ï¼š
    # ä¿®æ”¹ grub2 å¯åŠ¨å‚æ•°
    vi /etc/default/grub
    # ä¹Ÿæœ‰æ–‡ç« ä¿®æ”¹ /etc/sysconfig/grubï¼Œè¯¥æ–‡ä»¶æ˜¯ /etc/default/grub çš„é“¾æ¥
    # å¢åŠ å†…å®¹ï¼šnet.ifnames=0
    # åŸå†…å®¹ï¼š
    GRUB_CMDLINE_LINUX="crashkernel=auto resume=/dev/mapper/rl-swap rd.lvm.lv=rl/root rd.lvm.lv=rl/swap"
    # ä¿®æ”¹å (ä½ç½®å¹¶æ²¡æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œä¸€èˆ¬æ·»åŠ åœ¨æœ€åé¢å³å¯)ï¼š
    GRUB_CMDLINE_LINUX="crashkernel=auto resume=/dev/mapper/rl-swap rd.lvm.lv=rl/root rd.lvm.lv=rl/swap net.ifnames=0"
    #ä¿å­˜
    :x

    ## æ ‡å‡†åˆ†åŒºä¿®æ”¹ç¤ºä¾‹
    GRUB_CMDLINE_LINUX="crashkernel=auto resume=UUID=9c19ee14-b1a5-4c30-a9ca-7efc6c190dc7 net.ifnames=0"
   ```

   å› ä¸ºé»˜è®¤æ²¡æœ‰ `rhgb quiet` å‚æ•°ï¼Œä»¥ä¸‹ä»…é€‚ç”¨äº CentOSï¼š

   ```text
   # ç›´æ¥ç”¨ sed å‘½ä»¤æ›¿æ¢
   # CentOS 8
   sed -i 's/rhgb/net.ifnames=0 rhgb/' /etc/default/grub
   # CentOS 7
   sed -i 's/rhgb/net.ifnames=0 biosdevname=0 rhgb/' /etc/default/grub
   ```

2. è¿è¡Œå¦‚ä¸‹å‘½ä»¤é‡å»º grub.cfg æ–‡ä»¶

   ```bash
   # legacy boot mode
   grub2-mkconfig -o /boot/grub2/grub.cfg
   # UEFI boot mode
   grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg
   ```

3. é‡å‘½åç½‘å¡é…ç½®æ–‡ä»¶

   ```bash
   # é‡æ–°å¯¹æ–‡ä»¶è¿›è¡Œå‘½åï¼š
   cd /etc/sysconfig/network-scripts/
   mv ifcfg-ens33 ifcfg-eth0
   vi ifcfg-eth0
   ç¼–è¾‘ NAME=eth0
   ç¼–è¾‘ DEVICE=eth0
   æ³¨é‡Š HWADDRï¼Œå¦‚æœæœ‰
   ```

4. é‡å¯ç”Ÿæ•ˆ

   ```bash
   reboot
   ```

é‡æ–°ç™»å½•åï¼Œæ‰§è¡Œå‘½ä»¤ `nmcli` å¯ä»¥çœ‹åˆ°ç½‘å¡åç§°å·²ç»å˜æˆ â€œeth0â€ï¼Œåˆ™é…ç½®æˆåŠŸã€‚

å‚è€ƒï¼š[å®˜æ–¹æ–‡æ¡£][link002]

# ğŸš€ é…ç½®ç½‘ç»œ

## âœˆï¸ æ–¹æ³•ä¸€ï¼šæ‰‹å·¥é…ç½® ifcfgï¼Œä½¿ç”¨ nmcli æ¥ç”Ÿæ•ˆæ–°çš„ç½‘ç»œé…ç½®

å®‰è£…è¿‡ç¨‹ä¸­æœ€å¥½é…ç½®å¥½ç½‘ç»œï¼Œå¦‚æœéœ€è¦ç¼–è¾‘ç½‘ç»œï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š

```text
[root@localhost ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0

TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none  #staticï¼Œä½¿ç”¨é™æ€ IP é…ç½®ï¼ˆCentOS 8 è¿™é‡Œæ˜¯ none ä¹Ÿæ˜¯é™æ€ï¼‰
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=eth0
UUID=34f808f1-1232-4900-83db-82d32533f776
DEVICE=eth0
ONBOOT=yes  #å¼€æœºè‡ªåŠ¨å¯ç”¨ç½‘ç»œè¿æ¥
IPADDR=10.3.5.5  #IP åœ°å€
PREFIX=24  #æ©ç 
GATEWAY=10.3.5.1  #é»˜è®¤ç½‘å…³
DNS1=10.3.5.11  #DNS æœåŠ¡å™¨
DNS2=10.3.5.12  #å¤‡ç”¨ NDS æœåŠ¡å™¨
DOMAIN=sysin.org  #åŸŸå
IPV6_PRIVACY=no
```

```bash
nmcli c reload  #é‡æ–°åŠ è½½ç½‘ç»œé…ç½®
ping www.baidu.com  #æµ‹è¯•ç½‘ç»œæ˜¯å¦æ­£å¸¸
ip addr  #æŸ¥çœ‹ IP åœ°å€
```

é‡å¯ç½‘ç»œ

> æ¯”å¦‚é…ç½®äº†é™æ€è·¯ç”±ï¼Œä½¿ç”¨ nmcli c reload æ— æ³•ç”Ÿæ•ˆï¼Œéœ€è¦é‡å¯ç½‘ç»œ

```bash
systemctl restart NetworkManager.service
nmcli networking off && nmcli networking on
```

æ³¨æ„ï¼šCentOS 8 (é»˜è®¤å®‰è£…) é‡å¯ç½‘ç»œ â€œsystemctl restart networkâ€ å·²ç»ä¸å¯ç”¨ã€‚

CentOS 8 ç½‘å¡å‘½ä»¤ (CentOS 7 ä¹Ÿå¯ç”¨):

```bash
nmcli n  #æŸ¥çœ‹ nmcli çŠ¶æ€
nmcli n on  #å¯åŠ¨ nmcli
nmcli c up eth0  #å¯åŠ¨ç½‘å¡ eth0
nmcli c down eth0  #å…³é—­ç½‘å¡ eth0
nmcli d c eth0  #æ¿€æ´»ç½‘å¡
nmcli d show eth0  #æŸ¥çœ‹ç½‘å¡ eth0 ä¿¡æ¯
nmcli r all off  #å…³é—­æ— çº¿
```

## âœˆï¸ æ–¹æ³•äºŒï¼šRHEL8/CentOS8 å®Œå…¨ä½¿ç”¨ nmcli æ¥ç®¡ç†ç½‘ç»œ

nmcli å‘½ä»¤å¸®åŠ©ï¼š

å‘½ä»¤ä¸æ”¯æŒè‡ªåŠ¨è¡¥å…¨ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ - h å‚æ•°é€æ­¥è·å¾—å¸®åŠ©

```bash
## è¯´æ˜ nmcli åé¢çš„å‘½ä»¤å…³é”®å­—éƒ½å¯ä»¥ç”¨ç¬¬ä¸€ä¸ªå­—æ¯ç®€å†™æ¥æ ‡è¯†ï¼Œä¾‹å¦‚ï¼š
## nmcli connection = nmcli c
## nmcli connection show --active = nmcli c s --a
nmcli -h
nmcli connection -h
nmcli connection add -h
nmcli connection modify -h
```

åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„é…ç½®æ–‡ä»¶ï¼š

```text
IFACE=`nmcli dev|grep ethernet|awk '{print $1}'`
nmcli con delete $IFACE
# ä¸‹é¢å°†ä½¿ç”¨ä¼ ç»Ÿçš„ eth0 å‘½åæ–¹å¼ï¼Œå‰ææ˜¯å·²ç»åšäº†æ ¼å¼åŒ–ç½‘å¡åç§°çš„é…ç½®
nmcli con add con-name eth0 ifname eth0 type ethernet autoconnect yes

nmcli connection modify eth0 ipv4.method manual \
ipv4.addresses 10.3.5.5/24 \
ipv4.dns "10.3.5.11, 10.3.5.12" \
ipv4.gateway 10.3.5.1 \
ipv4.dns-search sysin.org

nmcli c up eth0
nmcli c reload
```

å¯ä»¥é…ç½®çš„å‚æ•°é€‰é¡¹ï¼š

ipv4.[method, dns, dns-search, dns-options, dns-priority, addresses, gateway, routes, route-metric, route-table, ignore-auto-routes, ignore-auto-dns, dhcp-client-id, dhcp-timeout, dhcp-send-hostname, dhcp-hostname, dhcp-fqdn, never-default, may-fail, dad-timeout]

nmcli ç¤ºä¾‹å‘½ä»¤å‚è€ƒï¼š

```bash
# æŸ¥çœ‹ç½‘å¡ä¿¡æ¯
nmcli connection
NAME    UUID                                  TYPE      DEVICE
eth0    db05ccae-3a48-4300-b3a6-7c56429c4f54  ethernet  eth0
# æ˜¾ç¤ºå…·ä½“çš„ç½‘ç»œæ¥å£ä¿¡æ¯
nmcli connection show eth0
# æ˜¾ç¤ºæ‰€æœ‰æ´»åŠ¨è¿æ¥
nmcli connection show --active
# åˆ é™¤ä¸€ä¸ªç½‘å¡è¿æ¥
nmcli connection delete eth0
# åˆ›å»ºä¸€ä¸ªç½‘å¡è¿æ¥
IFACE=`nmcli dev|grep ethernet|awk '{print $1}'`
nmcli con delete $IFACE
nmcli con add con-name "$IFACE" ifname "$IFACE" type ethernet autoconnect yes
# ç»™ eth0 æ·»åŠ ä¸€ä¸ª IP å’Œå­ç½‘æ©ç ï¼ˆNETMASKï¼‰
nmcli connection modify eth0 ipv4.addresses 10.3.5.5/24
# ç»™ eth0 æ·»åŠ ä¸¤ä¸ª IP åœ°å€å’Œæ©ç 
nmcli connection modify eth0 ipv4.addresses "10.3.5.5/24, 10.3.5.6/24"
# IP è·å–æ–¹å¼è®¾ç½®æˆæ‰‹åŠ¨ï¼ˆBOOTPROTO=static/noneï¼‰
nmcli connection modify eth0 ipv4.method manual
# æ·»åŠ ä¸€ä¸ª ipv4
nmcli connection modify eth0 +ipv4.addresses 10.3.5.6/24
# åˆ é™¤ä¸€ä¸ª ipv4
nmcli connection modify eth0 -ipv4.addresses 10.3.5.6/24
# æ·»åŠ  DNS
nmcli connection modify eth0 ipv4.dns 10.3.5.11
# åŒæ—¶æ·»åŠ ä¸¤ä¸ª DNS
nmcli connection modify eth0 ipv4.dns "10.3.5.11, 10.3.5.12"
# åˆ é™¤ DNS
nmcli connection modify eth0 -ipv4.dns 10.3.5.11
# åˆ é™¤ç¬¬ä¸€ä¸ª DNS
nmcli connection modify eth0 -ipv4.dns 1
# æ·»åŠ ä¸€ä¸ªç½‘å…³ï¼ˆGATEWAYï¼‰
nmcli connection modify eth0 ipv4.gateway 10.3.5.1
# éƒ½å¯ä»¥åŒæ—¶å†™ï¼Œä¾‹å¦‚ï¼š
nmcli connection modify eth0 ipv4.dns 10.3.5.11 ipv4.gateway 10.3.5.1
# åŸŸå dns-searchï¼Œå¯¹åº” ifcfg ä¸­çš„ DOMAIN
nmcli connection modify eth0 ipv4.dns-search sysin.org

# ä½¿ç”¨ nmcli é‡æ–°å›è½½ç½‘ç»œé…ç½®
nmcli c reload
# å¦‚æœä¹‹å‰æ²¡æœ‰ eth0 çš„ connectionï¼Œåˆ™ä¸Šä¸€æ­¥ reload åå°±å·²ç»è‡ªåŠ¨ç”Ÿæ•ˆäº†
nmcli c up eth0
```

## âœˆï¸ æ–¹æ³•ä¸‰ï¼šæ‰‹å·¥é…ç½® ifcfgï¼Œå®‰è£… network.service æœåŠ¡

å¯ä»¥é€šè¿‡ `yum install network-scripts` æ¥å®‰è£…ä¼ ç»Ÿçš„ network.serviceï¼Œä¸è¿‡ redhat è¯´äº†ï¼Œåœ¨ä¸‹ä¸€ä¸ª RHEL çš„å¤§ç‰ˆæœ¬é‡Œå°†å½»åº•åºŸé™¤ï¼Œå› æ­¤ä¸å»ºè®®ä½¿ç”¨ network.service

```bash
yum install network-scripts
service network restart   #é‡å¯ç½‘ç»œæœåŠ¡
systemctl restart network.service   #é‡å¯ç½‘ç»œæœåŠ¡
```

# ğŸš€ ä¿®æ”¹ä¸»æœºå

è¯´æ˜ï¼šä¸ CentOS 7 æ–¹æ³•ç›¸åŒ

- å³æ—¶ç”Ÿæ•ˆ

  ```bash
  hostname  sysin  #è®¾ç½®ä¸»æœºåä¸º sysin
  ```

- æ°¸ä¹…ç”Ÿæ•ˆ

  ```bash
  vi /etc/hostname #ç¼–è¾‘é…ç½®æ–‡ä»¶
  sysin   #ä¿®æ”¹ localhost.localdomain ä¸º sysin
  :x  #ä¿å­˜é€€å‡º

  æˆ–è€…ä½¿ç”¨å‘½ä»¤ï¼š`hostnamectl set-hostname sysin`

  åŒæ—¶ä¿®æ”¹ hosts æ–‡ä»¶ï¼š
  vi /etc/hosts #ç¼–è¾‘é…ç½®æ–‡ä»¶
  127.0.0.1   sysin   #å¢åŠ ä¸€æ¡
  :x  #ä¿å­˜é€€å‡º
  ```

é€šè¿‡å‘½ä»¤å¿«é€Ÿä¿®æ”¹ç¤ºä¾‹ï¼š

```bash
hostnamectl set-hostname sysin
# ä¸»æœºåè¿™é‡Œæ˜¯ sysinï¼Œæ›¿æ¢å®é™…åç§°ç›´æ¥æ‰§è¡Œ
NICName=`ip add|egrep global|awk '{print $NF}'|head -n 1`
IP=`ip add|grep global|awk -F'[/]+' '{ print $3 }'|head -n 1`
Hostname=`hostname`
HostnameAll=`hostname --fqdn` #æ³¨æ„è¿™é‡Œ `` ä¸æ˜¯å¼•å·
echo  "ç½‘å¡åç§°:$NICName"
echo  "IP åœ°å€:  $IP"
echo  "ä¸»æœºåç§°:  $Hostname $HostnameAll"
echo "$IP   $Hostname $HostnameAll">>/etc/hosts
```

# ğŸš€ æ¿€æ´» cockpit web console

CentOS 8 é»˜è®¤é›†æˆäº† cockpitï¼Œç™»å½•ç”»é¢æç¤ºæ¿€æ´»æ–¹æ³•ï¼ˆæ¨¡æ¿æœªå¯ç”¨ï¼‰ï¼š

```bash
systemctl enable --now cockpit.socket
```

ç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼š`http://<IP>:9090`

è¡¥å……è¯´æ˜ï¼š

```text
Cockpitï¼ˆé£æœºé©¾é©¶èˆ±ï¼‰ä½¿ç”¨æ–¹æ³•
åœ¨ web æµè§ˆå™¨ä¸­æŸ¥çœ‹æœåŠ¡å™¨å¹¶ä½¿ç”¨é¼ æ ‡æ‰§è¡Œç³»ç»Ÿä»»åŠ¡ã€‚å¾ˆå®¹æ˜“ç®¡ç†å­˜å‚¨ã€é…ç½®ç½‘ç»œå’Œæ£€æŸ¥æ—¥å¿—ç­‰æ“ä½œã€‚

1) RHEL 8 è‡ªåŠ¨å®‰è£…äº† Cockpitï¼ŒCockpit æ‰€éœ€çš„é˜²ç«å¢™ç«¯å£ä¼šè‡ªåŠ¨æ‰“å¼€
2) Cockpit ç•Œé¢å¯ç”¨äºå°†åŸºäºç­–ç•¥çš„è§£å¯†ï¼ˆPBDï¼‰è§„åˆ™åº”ç”¨äºå—ç®¡ç³»ç»Ÿä¸Šçš„ç£ç›˜
3) å¯¹äºåœ¨èº«ä»½ç®¡ç†ï¼ˆIdMï¼‰åŸŸä¸­æ³¨å†Œçš„ç³»ç»Ÿï¼ŒCockpit é»˜è®¤ä½¿ç”¨åŸŸçš„é›†ä¸­ç®¡ç†çš„ IdM èµ„æº
4) Cockpit èœå•å’Œé¡µé¢å¯ä»¥åœ¨ç§»åŠ¢æµè§ˆå™¨ä¸Šå¯¼èˆª
5) å¯ä»¥ä» Cockpit Web ç•Œé¢åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿæœº
6) ç°åœ¨å¯ä»¥å°† â€œè™šæ‹Ÿæœºâ€ é¡µé¢æ·»åŠ åˆ° Cockpit ç•Œé¢ï¼Œè¯¥ç•Œé¢ä½¿ç”¨æˆ·å¯ä»¥åˆ›å»ºå’Œç®¡ç†åŸºäº libvirt çš„è™šæ‹Ÿæœº

å®‰è£… cockpit
`yum -y install cockpit`

å¯ç”¨ cockpit
`systemctl enable --now cockpit.socket`

è®¾ç½®å¼€æœºè‡ªå¯åŠ¨åŒæ—¶å¼€å¯æœåŠ¡ä¸€æ¡å‘½ä»¤å°±å¯ä»¥æå®š

ä½¿ç”¨ Cockpit
Cockpit ç›‘å¬ 9090 ç«¯å£
ä½¿ç”¨æµè§ˆå™¨è®¿é—® `http://<IP>:9090`
```

# ğŸš€ å…³é—­ SELinux

SELinux æ˜¯ Linux ä¸­æœ€å¤è€çš„ä¸€ç§ MACï¼ˆå¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ŒMandatory Access Controlï¼‰
æ¨¡å‹ï¼Œå®ƒæ˜¯ç¾å›½å›½å®¶å®‰å…¨å±€çš„äº§å“ã€‚é™¤äº†åœ¨ä¸€äº›å¯¹å®‰å…¨æœ‰å¼ºåˆ¶çš„è¦æ±‚çš„è¡Œä¸šï¼ŒSELinux
æ›´å¤šçš„ä»¥éš¾ä»¥ç®¡ç†å’Œæ’é”™è€Œ â€œé—»åâ€ï¼Œé€šå¸¸è®¤ä¸ºå…¶ â€œå¼Šå¤§äºåˆ©â€ï¼Œ
è®¸å¤šåº”ç”¨å®‰è£…æ–‡æ¡£ä¸­éƒ½è¦æ±‚å…³é—­ SELinuxã€‚

ç¼–è¾‘é…ç½®æ–‡ä»¶ `/etc/selinux/config`ï¼š

```bash
vi /etc/selinux/config
# SELINUX=enforcing       #æ³¨é‡Šæ‰
# SELINUXTYPE=targeted    #æ³¨é‡Šæ‰
SELINUX=disabled         #å¢åŠ 
:x  #ä¿å­˜ï¼Œå…³é—­
```

æˆ–è€…ç›´æ¥ä½¿ç”¨ sed å‘½ä»¤ä¿®æ”¹ï¼š

```bash
# ä¿®æ”¹ SELINUX=enforcing ä¸º SELINUX=disabledï¼Œå³æ›¿æ¢è¡Œ
sed -i '/^SELINUX=.*/c SELINUX=disabled' /etc/selinux/config
# æˆ–è€…ï¼šsed -i '/^SELINUX=enforcing/c SELINUX=disabled' /etc/selinux/config
# æ³¨é‡Š SELINUXTYPE=targeted
sed -i 's/^SELINUXTYPE=targeted/#&/' /etc/selinux/config
```

ä½¿é…ç½®ç”Ÿæ•ˆï¼š

```bash
setenforce 0  #0=permissive, SELinux prints warnings instead of enforcing.
shutdown -r now  #æœ€ç»ˆé‡å¯ç³»ç»Ÿç”Ÿæ•ˆ

sestatus  #æŸ¥çœ‹çŠ¶æ€
sestatus -v  #Verbose è¯¦ç»†è¾“å‡º
# æˆ–è€…
getenforce
```

# ğŸš€ é…ç½® firewalld

å…³é—­ firewalldï¼ˆæ¨¡æ¿é…ç½®ï¼‰

CentOS 8 ä¸»è¦æ”¹åŠ¨å’Œ RedHat Enterprise Linux 8 æ˜¯ä¸€è‡´çš„ï¼ŒåŸºäº Fedora 28
å’Œå†…æ ¸ç‰ˆæœ¬ 4.18ï¼Œå…¶ä¸­ç½‘ç»œæ–¹é¢çš„ä¸»è¦æ”¹åŠ¨æ˜¯
**ç”¨ nftables æ¡†æ¶æ›¿ä»£ iptables æ¡†æ¶ä½œä¸ºé»˜è®¤çš„ç½‘ç»œåŒ…è¿‡æ»¤å·¥å…·**ã€‚

```bash
systemctl stop firewalld.service  #åœæ­¢ firewall
systemctl disable firewalld.service  #ç¦æ­¢ firewall å¼€æœºå¯åŠ¨
firewall-cmd --state  #æŸ¥çœ‹çŠ¶æ€
```

**firewalld å¸¸ç”¨å‘½ä»¤**ï¼ˆnftables ä½¿ç”¨ nft å‘½ä»¤ï¼Œå‚çœ‹å…¶ä»–æ–‡æ¡£ï¼‰

CentOS 8 ä¸­ firewalld å·²ç»ä¸ iptables è§£ç»‘ï¼Œåç«¯æ”¹ç”¨ nftablesï¼Œéœ€è¦ç”¨
`nft` æˆ–è€… `firewall-cmd` å¼€æ”¾ç«¯å£æˆ–è€…æœåŠ¡ã€‚

```bash
# æŸ¥çœ‹é…ç½®
firewall-cmd --list-all

firewall-cmd --list-services  #é»˜è®¤å¼€æ”¾ï¼šssh dhcpv6-client
firewall-cmd --zone=public --list-services  #æŒ‡å®šåŒºåŸŸè¿›è¡ŒæŸ¥çœ‹
firewall-cmd --list-ports
firewall-cmd --zone=public --list-ports  #æŒ‡å®šåŒºåŸŸè¿›è¡ŒæŸ¥çœ‹

# æŸ¥çœ‹é…ç½®ä¿å­˜æ–‡ä»¶
cat /etc/firewalld/zones/public.xml

# æ·»åŠ ä¸€ä¸ª TCP ç«¯å£ (åˆ é™¤å°† add å…³é”®å­—ä¿®æ”¹ä¸º remove)
firewall-cmd --zone=public --add-port=80/tcp --permanent  #--permanent è¡¨ç¤ºæ°¸ä¹…ç”Ÿæ•ˆ
firewall-cmd --add-port=80/tcp --permanent  #ä¸ä¸Šé¢æ˜¯ç­‰ä»·çš„ï¼Œé»˜è®¤ zone ä¸º pulic
firewall-cmd --reload  #é‡æ–°åŠ è½½é…ç½®ç”Ÿæ•ˆ

# å…³äº zone
firewall-cmd --get-zones  #æŸ¥çœ‹æ‰€æœ‰ zone çš„å‘½ä»¤ï¼ŒCentOS 7 ä¸€å…±æœ‰ 9 ä¸ª zone
block dmz drop external home internal public trusted work
firewall-cmd --get-zones  ##CentOS 8 æœ‰ 10 ä¸ª zone
block dmz drop external home internal libvirt public trusted work
firewall-cmd --get-default-zone  #æŸ¥çœ‹é»˜è®¤çš„ zone çš„å‘½ä»¤
public

# æ·»åŠ ä¸€ä¸ªæœåŠ¡
firewall-cmd --add-service=snmp --permanent
firewall-cmd --reload
firewall-cmd --get-services  #æŸ¥çœ‹å¯ç”¨çš„æœåŠ¡

# é™å®šæºåœ°å€è®¿é—®
firewall-cmd --add-rich-rule="rule family="ipv4"source address="192.168.1.0/24"port protocol="tcp"port="3306"accept" --permanent
firewall-cmd --reload
```

æ·»åŠ å‡ ä¸ªå¸¸ç”¨çš„æœåŠ¡ï¼š

```bash
firewall-cmd --add-service=snmp --permanent
firewall-cmd --add-service=http --permanent
firewall-cmd --add-service=https --permanent
firewall-cmd --reload
```

ç¦ Pingï¼š

```bash
firewall-cmd --permanent --add-rich-rule='rule protocol value=icmp drop'  #å…¨éƒ¨ç¦ ping
firewall-cmd --permanent --add-rich-rule='rule family="ipv4"source address="192.168.1.0/24"protocol value="icmp"accept'  #æŒ‡å®š 192.168.1.0/24 å…è®¸ icmp
```

# ğŸš€ å®‰è£… EPEL (Extra Packages for Enterprise Linux)

```bash
yum -y install epel-release

æˆ–è€… (EL8):
rpm -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
rpm â€“import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8
```

# ğŸš€ æ›´æ¢å›½å†…é•œåƒ yum æº

Rocky Linux é»˜è®¤ repo å¦‚ä¸‹ï¼š

```bash
[root@localhost ~]# dnf repolist
repo id                                                      repo name
appstream                                                    Rocky Linux 8 - AppStream
baseos                                                       Rocky Linux 8 - BaseOS
extras                                                       Rocky Linux 8 - Extras
[root@localhost ~]# cd /etc/yum.repos.d/
[root@localhost yum.repos.d]# ll
total 44
-rw-r--r--. 1 root root  700 Jun 19 22:20 Rocky-AppStream.repo
-rw-r--r--. 1 root root  685 Jun 19 22:20 Rocky-BaseOS.repo
-rw-r--r--. 1 root root  713 Jun 19 22:20 Rocky-Devel.repo
-rw-r--r--. 1 root root  685 Jun 19 22:20 Rocky-Extras.repo
-rw-r--r--. 1 root root  721 Jun 19 22:20 Rocky-HighAvailability.repo
-rw-r--r--. 1 root root  680 Jun 19 22:20 Rocky-Media.repo
-rw-r--r--. 1 root root  685 Jun 19 22:20 Rocky-Plus.repo
-rw-r--r--. 1 root root  705 Jun 19 22:20 Rocky-PowerTools.repo
-rw-r--r--. 1 root root  736 Jun 19 22:20 Rocky-ResilientStorage.repo
-rw-r--r--. 1 root root  671 Jun 19 22:20 Rocky-RT.repo
-rw-r--r--. 1 root root 2407 Jun 19 22:20 Rocky-Sources.repo
```

Rocky Linux å›½å†…é•œåƒæº

ä¸Šæµ·äº¤é€šå¤§å­¦ç¤ºä¾‹ï¼š

```bash
sed -e 's|^mirrorlist=|#mirrorlist=|g' \
    -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.sjtug.sjtu.edu.cn/rocky|g' \
    -i.bak \
    /etc/yum.repos.d/Rocky-*.repo
```

æ›´æ¢å…¶ä»–é•œåƒï¼Œå¯¹åº”æŒ‰ç…§ä¸Šé¢æ›¿æ¢ Mirror Name å³å¯ï¼Œæ³¨æ„è·¯å¾„ â€œ/rockyâ€ã€‚

å®˜æ–¹åˆ—è¡¨ï¼š<https://mirror.rockylinux.org/mirrormanager/mirrors>

ä¿®æ”¹ epelï¼Œè‹¥å®‰è£…äº† epelï¼ŒåŒæ—¶ä¿®æ”¹å¦‚ä¸‹ï¼š

```text
# dnf repolist
repo id                                         repo name
appstream                                       Rocky Linux 8 - AppStream
baseos                                          Rocky Linux 8 - BaseOS
epel                                            Extra Packages for Enterprise Linux 8 - x86_64
epel-modular                                    Extra Packages for Enterprise Linux Modular 8 - x86_64
extras                                          Rocky Linux 8 - Extras

# ä¿®æ”¹ epel(url ä¸ä¸€æ ·)
sed -e 's/metalink=/#metalink=/g' \
    -e 's/#baseurl=/baseurl=/g' \
    -e 's/https:\/\/download.fedoraproject.org\/pub/https:\/\/mirrors.aliyun.com/g' \
    -i.bak \
    /etc/yum.repos.d/epel*.repo
```

æ¸…ç†å¹¶é‡æ–°ç”Ÿæˆè½¯ä»¶åŒ…ä¿¡æ¯ç¼“å­˜

```bash
yum clean all
yum autoremove
rm -rf /var/cache/yum
yum makecache
```

# ğŸš€ æ’é™¤ä¸éœ€è¦çš„æ›´æ–°åŒ…

ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```text
# ä¿®æ”¹ yum çš„é…ç½®æ–‡ä»¶
vi /etc/yum.conf
# åœ¨ [main] çš„æœ€åæ·»åŠ  exclude=kernel*

# ç¤ºä¾‹ï¼š
[main]
gpgcheck=1
installonly_limit=3
clean_requirements_on_remove=True
best=True
exclude=kernel* rocky-release
# å¤šä¸ªåŒ…åç§°ç”¨ç©ºæ ¼éš”å¼€
# exclude=kernel* php* rocky-release
```

ç›´æ¥å‘½ä»¤æ·»åŠ ï¼š

```bash
echo 'exclude=kernel* rocky-release' >> /etc/yum.conf
```

> æ’é™¤äº† rocky-releaseï¼Œæ›´æ–°åç‰ˆæœ¬ä¹Ÿä¿æŒåœ¨å½“å‰ç‰ˆæœ¬ï¼Œå®Œç¾ï¼
>
> é¦–ä¸ª 8.4 æ¨¡æ¿æ²¡æœ‰æ’é™¤ rocky-releaseã€‚8.5 å°†å¯ç”¨è¯¥é¡¹é…ç½®ã€‚

è¯´æ˜ï¼š

é€šå¸¸åœ¨ç”¨ yum è¿›è¡Œæ›´æ–°æ—¶è€æ˜¯ä¼šæ›´æ–°å†…æ ¸ï¼Œè¿™æ ·å°±é€ æˆäº†ä¸¤ä¸ªé—®é¢˜ï¼š

1. å†…æ ¸è¿‡å¤šï¼Œå ç”¨ç³»ç»Ÿçš„ç©ºé—´
2. å¦‚æœæ˜¯è‡ªè¡Œç¼–è¯‘å®‰è£…çš„ nvidia æ˜¾å¡é©±åŠ¨çš„è¯ï¼Œè¿›å…¥æ›´æ–°çš„æ ¸å¿ƒæ—¶éœ€è¦å†é‡æ–°å®‰è£…æ˜¾å¡é©±åŠ¨

è¿™é‡Œä»‹ç»å¥½çš„åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨æ›´æ–°æ—¶æ’é™¤å¯¹å†…æ ¸çš„æ›´æ–°ï¼Œæ–¹æ³•æœ‰ä¸¤ä¸ª:

1. ä¿®æ”¹ yum çš„é…ç½®æ–‡ä»¶ `vi /etc/yum.conf`ï¼Œåœ¨ `[main]` çš„æœ€åæ·»åŠ  `exclude=kernel*`
2. ç›´æ¥åœ¨ yum çš„å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤ï¼š
   `yum update --exclude=kernel* --exclude=rocky-release`

ä»¥ä¸Šçš„åŠæ³•ä¹Ÿé€‚åˆä½ è¦æ±‚è‡ªè¡Œæ’é™¤çš„å…¶å®ƒæ›´æ–°è½¯ä»¶åŒ…ã€‚

å¤‡æ³¨ï¼šå®‰è£…æŸäº›è½¯ä»¶åŒ…éœ€è¦æ–°ç‰ˆå†…æ ¸æ”¯æŒï¼Œéœ€è¦åˆ é™¤ä»¥ä¸Šé…ç½®ã€‚

# ğŸš€ æ›´æ–°è½¯ä»¶åŒ…

```bash
#æ¸…ç†
dnf autoremove
dnf clean all
rm -rf /var/cache/dnf

dnf makecache  #ç¼“å­˜è½¯ä»¶åŒ…ä¿¡æ¯
dnf upgrade  # = dnf updateï¼Œæ›´æ–°è½¯ä»¶åŒ…ï¼ŒåŒ…æ‹¬å†…æ ¸åŠç³»ç»Ÿç‰ˆæœ¬

#å†æ¬¡æ¸…ç†
dnf autoremove
dnf clean all
rm -rf /var/cache/dnf

rm -rf /tmp/*  #æ¸…ç©ºä¸´æ—¶æ–‡ä»¶ç›®å½•
```

# ğŸš€ å®‰è£…ä¸€äº›å¿…å¤‡å·¥å…·

```bash
## yum = dnf
# ä¸€äº›åŸºæœ¬å·¥å…·æœ€å°åŒ–å®‰è£…å¯èƒ½æ²¡æœ‰ (ç»æµ‹ vim å’Œ wget ç­‰æ²¡æœ‰å®‰è£…)
yum -y install vim wget zip unzip

# å¼€å‘å·¥å…·
# ç³»ç»Ÿå®‰è£…è¿‡ç¨‹ä¸­å»ºè®®å‹¾é€‰ "Development Tools" ç»„ä»¶
# ä½†æ˜¯ä¸‹é¢çš„å‘½ä»¤å°†å®‰è£…æ›´å¤šçš„è½¯ä»¶åŒ…ï¼ˆæ¯”å¦‚ gccã€git ç­‰ï¼‰
# å¯ä»¥é€šè¿‡å‘½ä»¤ `yum groupinfo "Development Tools"` æ¥æŸ¥çœ‹è¯¦ç»†çš„è½¯ä»¶åŒ…åˆ—è¡¨
yum groupinstall "Development Tools"

# Rocky Linux é»˜è®¤æ²¡æœ‰ tar å‘½ä»¤ï¼ŒAlmaLinux ä¹Ÿæ²¡æœ‰ï¼Œä½†æ˜¯ CentOS é»˜è®¤æœ‰
yum -y install tar

# ä»¥ä¸‹ç½‘ç»œå·¥å…·å·²ç»ä¸å­˜åœ¨
# yum -y install setuptool system-config-network-tui system-config-firewall-tui

# é»˜è®¤å®‰è£…æ²¡æœ‰ ifconfig å‘½ä»¤ï¼Œå®‰è£… net-tools
# ifconfigã€netstatã€route ç­‰å‘½ä»¤é›†
yum -y install net-tools

# hostã€dig å’Œ nslookup
yum -y install bind-utils

# æ›´å¥½çš„ top å·¥å…·
yum -y install htop
#Anolis OS ä¸­æ²¡æœ‰
#https://github.com/hishamhm/htop

# æ–‡ä»¶ä¼ è¾“ï¼šsz å’Œ rz
yum -y install lrzsz

# æŸ¥çœ‹æ—¥å¿—ç¥å™¨ Log file Navigator
yum -y install lnav
# è¯¥è½¯ä»¶ç°åœ¨å·²ç»åŒ…å«åœ¨ EPEL ä¸­
# åˆæœŸ EPEL ä¸­æ²¡æœ‰ï¼Œç›´æ¥åœ¨çº¿å®‰è£…
#rpm -ivh https://github.com/tstack/lnav/releases/download/v0.9.0/lnav-0.9.0-1.x86_64.rpm
#Anolis OS ä¸­æ²¡æœ‰

# NTP å·²ç»åºŸå¼ƒï¼Œæ”¹ç”¨ chronyï¼Œé»˜è®¤è‡ªå¸¦
# yum -y install ntp

# nc:
yum -y install nc

# lsof:
yum -y install lsof

# tree:
yum -y install tree

# pstree:
yum -y install psmisc

# ncduï¼šNCurses Disk Usage
yum -y install ncdu

# dstat ç›‘æ§ CPUã€ç£ç›˜å’Œç½‘ç»œä½¿ç”¨ç‡
yum -y install dstat
```

fd å‘½ä»¤ï¼ˆfd-findï¼Œå¼ºçƒˆæ¨èï¼‰

```bash
# ä¸‹è½½ï¼ˆäºŒé€‰ä¸€ï¼‰ï¼š
# gcc ç¼–è¯‘ç‰ˆæœ¬
wget https://github.com/sharkdp/fd/releases/download/v8.0.0/fd-v8.0.0-x86_64-unknown-linux-gnu.tar.gz
# musl libc ç¼–è¯‘ç‰ˆæœ¬ (æ¨è)
wget https://github.com/sharkdp/fd/releases/download/v8.0.0/fd-v8.0.0-x86_64-unknown-linux-musl.tar.gz

# å®‰è£…ï¼š
tar -zxvf fd-v8.0.0-x86_64-unknown-linux-*.tar.gz
cd fd-v8.0.0-x86_64-unknown-linux-musl

cp ./fd /usr/local/bin/
cp ./fd.1 /usr/local/share/man/man1/
mandb
```

> å¯ä»¥æ ¹æ®ä¸ªäººä¹ æƒ¯å®‰è£…ä¸€äº›å¸¸ç”¨å·¥å…·ã€‚

# ğŸš€ é…ç½® NTP

åœ¨ CentOS 8.0 ä¸­é»˜è®¤ä¸å†æ”¯æŒ ntp è½¯ä»¶åŒ…ï¼Œæ—¶é—´åŒæ­¥å°†ç”± chrony æ¥å®ç°ï¼ˆé»˜è®¤å·²å®‰è£…ï¼‰ã€‚

```bash
cat /etc/chrony.conf
# Use public servers from the pool.ntp.org project.
# Please consider joining the pool (http://www.pool.ntp.org/join.html).
# These servers were defined in the installation:
pool 2.pool.ntp.org iburst  #Rocky default

pool 2.centos.pool.ntp.org iburst #CentOS default
# å…¶ä»–
pool 0.pool.ntp.org iburst
pool ntp1.aliyun.com iburst
pool ntp2.aliyun.com iburst
```

chrony è‡ªå¸¦ä¸€ä¸ªäº¤äº’å¼å·¥å…· chronycï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº†æ—¶é—´æœåŠ¡å™¨ä¹‹åï¼Œ
å¦‚æœæƒ³æŸ¥çœ‹åŒæ­¥çŠ¶æ€ï¼Œå¯ä»¥è¿›å…¥è¿™ä¸ªäº¤äº’å¼å·¥å…·çš„äº¤äº’ç•Œé¢ã€‚

```bash
chronyc æœ‰å¾ˆå¤šçš„å­å‘½ä»¤ï¼Œå¯ä»¥è¾“å…¥ help æ¥æŸ¥çœ‹
chronyc> help
    é€‰é¡¹ï¼š
    sources [-v]    æ˜¾ç¤ºå…³äºå½“å‰æ¥æºçš„ä¿¡æ¯
    sourcestats [-v]      æ˜¾ç¤ºæ—¶é—´åŒæ­¥çŠ¶æ€ï¼ˆå¦‚æ—¶é—´åç§»äº†å¤šå°‘ä¹‹ç±»ï¼‰
```

æŸ¥çœ‹

```bash
chronyc sources -v
chronyc sourcestats -v
```

# ğŸš€ å®‰è£… SNMP

```bash
yum -y install net-snmp net-snmp-devel net-snmp-libs net-snmp-utils

# å¯¹æ¯” CentOS 7 net-snmp-perl å·²ç»ä¸å­˜åœ¨ (æœªçŸ¥)
# å› ä¸ºæ˜¯æ¨¡æ¿ï¼Œè¿™é‡Œæš‚ä¸é…ç½®
```

# ğŸš€ è™šæœºå®‰è£… VM-tools

åœ¨ç³»ç»Ÿå®‰è£…æ—¶å€™å‹¾é€‰äº† â€œGuest Agentâ€ï¼Œå°†è‡ªåŠ¨å®‰è£… open-vm-tools

```bash
æ‰‹åŠ¨å®‰è£… open-vm-toolsï¼š
# http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2073803
yum -y install open-vm-tools

# å¼€å¯æœåŠ¡
#chkconfig vmtoolsd on
systemctl enable vmtoolsd.service

# å¯åŠ¨æœåŠ¡
#service vmtoolsd start
systemctl start vmtoolsd

# æŸ¥çœ‹ç‰ˆæœ¬
vmtoolsd -v
#ç°åœ¨å·²ç» 11.2.0
VMware Tools daemon, version 11.2.0.23855 (build-16938113)
```

# ğŸš€ å®‰è£…å›¾å½¢ç•Œé¢

åŸºäºç‰¹å®šåœºæ™¯éœ€è¦ï¼Œä¸€èˆ¬ä¸ç”¨å®‰è£…

```bash
yum grouplist  #æŸ¥çœ‹å¯å®‰è£…çš„ç»„ä»¶

yum groupinstall "Server with GUI"  #å®‰è£… GNOME å›¾å½¢ç•Œé¢ (ä¸ CentOS 7 åç§°ä¸ä¸€æ ·)
yum groupinstall "Graphical Administration Tools"  #å°†è‡ªåŠ¨å®‰è£…

startx  #å¯åŠ¨å›¾å½¢ç•Œé¢
```

å®ä¾‹ï¼š

```bash
[root@localhost ~]# yum grouplist
Last metadata expiration check: 1:12:58 ago on Sat 09 Nov 2019 03:59:09 PM CST.
Available Environment Groups:
   Server with GUI
   Server
   Workstation
   KDE Plasma Workspaces
   Virtualization Host
   Custom Operating System
Installed Environment Groups:
   Minimal Install
Installed Groups:
   Development Tools
Available Groups:
   Container Management
   .NET Core Development
   RPM Development Tools
   Smart Card Support
   Graphical Administration Tools
   Headless Management
   Legacy UNIX Compatibility
   Network Servers
   Scientific Support
   Security Tools
   System Tools
   Fedora Packager
```

```bash
[root@localhost ~]# yum groupinstall "Server with GUI"
Installing Environment Groups:
 Server with GUI
Installing Groups:
 Container Management
 Core
 Fonts
 GNOME
 Guest Desktop Agents
 Hardware Monitoring Utilities
 Hardware Support
 Headless Management
 Internet Browser
 Multimedia
 Common NetworkManager submodules
 Printing Client
 Server product core
 Standard

Transaction Summary
==============================================================================================================
Install  744 Packages

Total download size: 696 M
Installed size: 2.1 G
Is this ok [y/N]:
```

# ğŸš€ Shell é…ç½®

## âœˆï¸ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨å¿½ç•¥å¤§å°å†™

è¯¥é…ç½®é’ˆå¯¹ Bashï¼Œä»…ä½¿ç”¨ Zsh å¯ä»¥å¿½ç•¥ã€‚

```bash
echo 'set completion-ignore-case on' >> ~/.inputrc
```

## âœˆï¸ ä¿®æ”¹ ll å‘½ä»¤

Linux ä¸­é»˜è®¤å®šä¹‰äº† ll åˆ«åï¼Œä½†å‚æ•°æ¯”è¾ƒå°‘ï¼Œéœ€è¦ä½¿ç”¨æ›´åŠ å¼ºå¤§çš„ ll åˆ«åã€‚

å†™å…¥ç¯å¢ƒå˜é‡ï¼ˆå½“å‰ç”¨æˆ·ä¼˜å…ˆæ‰§è¡Œï¼‰ï¼š

bashï¼š

```bash
echo 'alias ll="ls -lahF --color=auto --time-style=long-iso"' >> ~/.bashrc
```

zshï¼ˆç¨åé…ç½®ï¼‰ï¼š

```bash
echo 'alias ll="ls -lahF --color=auto --time-style=long-iso"' >> ~/.zshrc
```

æ³¨æ„ï¼šä»…ä»…é’ˆå¯¹å½“å‰ç”¨æˆ·ï¼Œå†™å…¥å…¨å±€ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼š/etc/skel/.bashrc æˆ–è€…
/etc/skel/.zshrc

## âœˆï¸ é«˜çº§ç‰ˆ lsï¼šä»¥æ•°å­—æ˜¾ç¤ºæƒé™

è¿™é‡Œæˆ‘ä»¬æŠŠå‘½ä»¤å«åš lll

å‘½ä»¤ï¼š

```bash
ls -lahF --color=auto --time-style=long-iso | awk '{k=0;s=0;for(i=0;i<=8;i++){k+=((substr($1,i+2,1)~/[rwxst]/)*2^(8-i))}j=4;for(i=4;i<=10;i+=3){s+=((substr($1,i,1)~/[stST]/)*j);j/=2}if(k){printf("%0o%0o ",s,k)}print}'
```

åˆ›å»ºæ–‡ä»¶

> åœ¨ä½¿ç”¨ cat EOF ä¸­å‡ºç° $ å˜é‡é€šå¸¸ä¼šç›´æ¥è¢«æ‰§è¡Œï¼Œæ˜¾ç¤ºæ‰§è¡Œçš„ç»“æœã€‚
> è‹¥æƒ³ä¿æŒ $ å˜é‡ä¸å˜éœ€è¦ä½¿ç”¨ \ ç¬¦è¿›è¡Œæ³¨é‡Šã€‚

```bash
# å¦‚æœé root ç”¨æˆ·ï¼Œè¯·å…ˆåˆ‡æ¢åˆ° root
sudo -i
cat > /usr/local/bin/lll <<EOF
#!/bin/bash
ls -lahF --color=auto --time-style=long-iso | awk '{k=0;s=0;for(i=0;i<=8;i++){k+=((substr(\$1,i+2,1)~/[rwxst]/)*2^(8-i))}j=4;for(i=4;i<=10;i+=3){s+=((substr(\$1,i,1)~/[stST]/)*j);j/=2}if(k){printf("%0o%0o ",s,k)}print}'
EOF
# å¦‚æœé root ç”¨æˆ·ï¼Œæ— éœ€åˆ‡æ¢ root æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š
sudo sh -c "cat > /usr/local/bin/lll" <<EOF
#!/bin/bash
ls -lahF --color=auto --time-style=long-iso | awk '{k=0;s=0;for(i=0;i<=8;i++ ){k+=((substr(\$1,i+2,1)~/[rwxst]/)*2^(8-i))}j=4;for(i=4;i<=10;i+=3){s+=((substr(\$1,i,1)~/[stST]/)*j);j/=2}if(k){printf("%0o%0o ",s,k)}print}'
EOF
# èµ‹äºˆæ‰§è¡Œæƒé™ï¼š
chmod +x /usr/local/bin/lll
```

## âœˆï¸ vi å’Œ vim

CentOS 8 ç³»åˆ—é»˜è®¤è‡ªå¸¦çš„ vi = vim-minimalï¼ŒåŠŸèƒ½æœ‰é™ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…
vimï¼ˆvim = vim-enhancedï¼‰ã€‚

```bash
yum -y install vim
#yum -y install vim-enhanced
```

åˆ›å»º vi é“¾æ¥ç›´æ¥ä½¿ç”¨ vimï¼š

```bash
ln -s /usr/bin/vim /usr/local/bin/vi
```

åˆ›å»º vimrc é…ç½®æ–‡ä»¶ï¼š

å¯ä»¥æ ¹æ®ä¸ªäººä¹ æƒ¯æ¥é…ç½® vimï¼Œå¹¶ç”¨äºå…¨å±€é…ç½®ã€‚

```bash
# å½“é¢ç”¨æˆ·
~/.vimrc
# å…¨å±€æ–°ç”¨æˆ·é»˜è®¤
/etc/skel/.vimrc
```

# ğŸš€ Zsh

ä»¥ä¸‹æ˜¯é’ˆå¯¹å½“å‰ç”¨æˆ·é…ç½®ã€‚[å…¨å±€é…ç½®][link003] è¯·å‚çœ‹å…¶ä»–æ–‡ç« ï¼Œ**è¿™é‡Œç›´æ¥ä½¿ç”¨å…¨å±€é…ç½®æ–‡ä»¶å³å¯**ã€‚

```bash
# Zsh
yum -y install zsh
# or
#dnf -y install zsh
yum -y install util-linux-user

chsh -s /bin/zsh

yum -y install git

sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"

sed -i '/^ZSH_THEME=.*/c ZSH_THEME="ys"' ~/.zshrc

echo 'alias ll="ls -lahF --color=auto --time-style=long-iso"' >> ~/.zshrc

git clone https://github.com/sangrealest/zsh-autosuggestions.git ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions

sed -i '/^plugins=.*/c plugins=(git zsh-autosuggestions)' ~/.zshrc

source ~/.zshrc
```

# ğŸš€ æ¸…ç†å¹¶åˆ¶ä½œé•œåƒæ¨¡æ¿

æ¸…ç† dnf/yum ç¼“å­˜

```bash
dnf autoremove
dnf clean all
```

æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤¹

```bash
rm -rf /tmp/*  #æ¸…ç©ºä¸´æ—¶æ–‡ä»¶å¤¹
```

æ¸…ç©ºå†å²è®°å½•

```bash
#æ¯”è¾ƒå®Œæ•´çš„æ¸…ç©ºå†å²è®°å½•
rm -f /var/log/audit/audit*
echo > /var/log/audit/audit.log
rm -f /var/log/secure*
echo > /var/log/secure
rm -f /var/log/btmp*
echo > /var/log/btmp
rm -f /var/log/wtmp*
echo > /var/log/wtmp
echo > /var/log/lastlog
echo > ~/.bash_history
echo > ~/.zsh_history
history -c
```

è‡³æ­¤ï¼ŒRocky Linux çš„åŸºæœ¬é…ç½®å·²ç»å®Œæˆï¼Œå¯ä»¥åˆ¶ä½œæ¨¡æ¿äº†ã€‚

# ğŸš€ åˆ é™¤æ—§å†…æ ¸

é»˜è®¤æƒ…å†µä¸‹ yum åŒ…ç®¡ç†å™¨æœ€å¤šå®‰è£… 3 ä¸ªç‰ˆæœ¬çš„ Linux å†…æ ¸ã€‚å› æ­¤ï¼Œå†…æ ¸å¼•å¯¼æ¡ç›®ä»…é™äº 3 ä¸ªã€‚

```bash
# æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼Œuname -a ä¹Ÿå¯ä»¥
uname -r
# æŸ¥çœ‹é»˜è®¤å†…æ ¸ç‰ˆæœ¬
grubby --default-kernel
```

```bash
# æŸ¥çœ‹å·²å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬
rpm -q kernel
# æŸ¥çœ‹å·²å®‰è£…çš„æ‰€æœ‰çš„å†…æ ¸åŒ…
rpm -qa | grep kernel
```

```bash
# åˆ é™¤å†…æ ¸ï¼Œä¼šè‡ªåŠ¨åˆ é™¤ä¾èµ–ï¼Œåº”è¯¥æ˜¯åˆ é™¤ä¸‰ä¸ª kernel ç›¸å…³çš„åŒ…
dnf remove kernel-core-4.18.0-147.el8.x86_64
```

```bash
# é‡å¯ï¼Œåº”è¯¥å·²ç»è‡ªåŠ¨æ¸…ç†å¯åŠ¨é¡¹äº†
reboot
```

# ğŸš€ ä¿®æ”¹ grub é»˜è®¤ç­‰å¾…æ—¶é—´

- ä¿®æ”¹ grub é»˜è®¤é…ç½®æ–‡ä»¶
  ä¿®æ”¹ `/etc/default/grub` æ–‡ä»¶çš„ `GRUB_TIMEOUT` é€‰é¡¹ä¸º `1`ï¼Œ
  å³ï¼š`GRUB_TIMEOUT=1`ï¼Œä¸ºé»˜è®¤ç­‰å¾… 1 ç§’ï¼Œå¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™ä¸ºç›´æ¥è¿›å…¥ç³»ç»Ÿã€‚
- ç”Ÿæˆ grub å¯åŠ¨é…ç½®æ–‡ä»¶ï¼Œä½¿ä¿®æ”¹ç”Ÿæ•ˆ

  é¦–å…ˆæ£€æŸ¥ä¸€ä¸‹å¯åŠ¨é…ç½®æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼ŒUEFI + GPT ä¸º `/boot/efi/EFI/rocky`ã€‚

  - è‹¥ `/boot/efi/EFI/rocky` æ–‡ä»¶å¤¹ä¸ºç©ºï¼Œåˆ™å­˜æ”¾è·¯å¾„ä¸º `/boot/grub2`ã€‚
  - è‹¥ `/boot/efi/EFI/rocky` æ–‡ä»¶å¤¹ä¸ä¸ºç©ºï¼Œåˆ™å­˜æ”¾è·¯å¾„ä¸º `/boot/efi/EFI/rocky`ï¼Œ
    è€Œ `/boot/grub2` æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å¤šä¸ºè½¯é“¾æ¥ï¼Œé“¾æ¥åˆ° `/boot/efi/EFI/rocky` ä¸‹çš„æ–‡ä»¶ã€‚

  ```bash
   # å¦‚æœæ˜¯ UEFI + GPTï¼Œç”Ÿæˆé…ç½®æ–‡ä»¶å‘½ä»¤å¦‚ä¸‹ï¼š
   grub2-mkconfig -o /boot/efi/EFI/rocky/grub.cfg
   # å¦‚æœä¸æ˜¯ UEFI + GPTï¼Œç”Ÿæˆé…ç½®æ–‡ä»¶å‘½ä»¤å¦‚ä¸‹ï¼š
   grub2-mkconfig -o /boot/grub2/grub.cfg
   # é‡å¯æµ‹è¯•æ˜¯å¦ä¿®æ”¹æˆåŠŸ
  ```

# ğŸš€ å…³é—­å†…æ ¸è½¬å‚¨æœåŠ¡ï¼Œé‡Šæ”¾å†…å­˜

å†…æ ¸è½¬å‚¨æœåŠ¡æ˜¯å½“å†…æ ¸å´©æºƒçš„æ—¶å€™ï¼Œå°†å´©æºƒæ—¶çš„ä¸€éƒ¨åˆ†å†…å­˜ä¸­çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå†…å­˜é•œåƒï¼Œ
ç”¨æ¥è°ƒè¯•å†…æ ¸çš„ï¼Œè¿™ä¸ªæœåŠ¡ä¼šé•¿æœŸå æ®ä¸€éƒ¨åˆ†å†…å­˜ç©ºé—´ã€‚

```bash
# æŸ¥çœ‹å†…å­˜ç”¨é‡
free -m
# æŸ¥çœ‹å†…æ ¸è½¬å‚¨æœåŠ¡è¿è¡ŒçŠ¶æ€
systemctl status kdump
# å…³é—­å¹¶ç¦ç”¨æ­¤æœåŠ¡ï¼Œæ–¹æ³•ä¸€ï¼š
systemctl disable --now kdump.service
# å…³é—­å¹¶ç¦ç”¨æ­¤æœåŠ¡ï¼Œæ–¹æ³•äºŒï¼š
systemctl stop kdump && systemctl disable kdump
# ä¿®æ”¹ grub é»˜è®¤é…ç½®
sed -i 's/crashkernel=auto //g' /etc/default/grub
# ä½¿ grub ä¿®æ”¹ç”Ÿæ•ˆï¼Œä¸‹é¢å‘½ä»¤é€‚ç”¨äºé UEFI + GPT å¯åŠ¨ï¼Œ
# å…·ä½“æŸ¥çœ‹ä¸Šé¢ `ä¿®æ”¹ grub é»˜è®¤ç­‰å¾…æ—¶é—´` ä¸€èŠ‚å†…å®¹
grub2-mkconfig -o /boot/grub2/grub.cfg
# é‡å¯
reboot
# æŸ¥çœ‹å†…æ ¸è½¬å‚¨æœåŠ¡è¿è¡ŒçŠ¶æ€
systemctl status kdump
# æŸ¥çœ‹å†…å­˜ç”¨é‡
free -m
```

# ğŸš€ åˆ é™¤ cockpit çš„ Podman å®¹å™¨æ¨¡å—

```bash
# å¸è½½ podman ç›¸å…³åŒ…å’Œ cockpit çš„ podman ç›¸å…³åŒ…
dnf remove podman* cockpit-podman*
```

# ğŸš€ å®‰è£… cockpit çš„è™šæ‹Ÿæœºæ¨¡å—

```bash
# æŸ¥çœ‹ cockpit æä¾›çš„æ¨¡å—
dnf search cockpit-
# å®‰è£… cockpit çš„è™šæ‹Ÿæœºæ¨¡å—
dnf install cockpit-machines
# é‡å¯é¢æ¿æœåŠ¡æˆ–é‡å¯æœºå™¨
```

# ğŸš€ ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°å’Œå†…æ ¸è¡¥ä¸

åœ¨ `cockpit` web é¢æ¿çš„è½¯ä»¶æ›´æ–°æ¨¡å—å¯ä»¥è®¾ç½®ï¼Œå‘½ä»¤è¡Œä¹Ÿå¯ä»¥è®¾ç½®

# ğŸš€ é˜²ç«å¢™ç›¸å…³æ“ä½œ

- æŸ¥çœ‹é˜²ç«å¢™æ˜¯å¦å¼€å¯äº† 80 ç«¯å£

  ```bash
  firewall-cmd --query-port=80/tcp
  ```

- é˜²ç«å¢™å¼€æ”¾ 80 ç«¯å£

  ```bash
  firewall-cmd --zone=public --add-port=80/tcp --permanent
  ```

- é˜²ç«å¢™å…³é—­ 80 ç«¯å£

  ```bash
  firewall-cmd --zone=public --remove-port=80/tcp --permanent
  ```

- é˜²ç«å¢™é‡æ–°è½½å…¥é…ç½®ï¼Œç«‹å³ç”Ÿæ•ˆ

  ```bash
  firewall-cmd --reload
  ```

- æŸ¥çœ‹é˜²ç«å¢™æœåŠ¡çŠ¶æ€

  ```bash
  systemctl status firewalld
  ```

- å…³é—­é˜²ç«å¢™æœåŠ¡

  ```bash
  systemctl stop firewalld
  ```

- æ‰“å¼€é˜²ç«å¢™æœåŠ¡

  ```bash
  systemctl start firewalld
  ```

- é˜²ç«å¢™å¼€æ”¾ä¸€æ®µç«¯å£

  ```bash
  firewall-cmd --zone=public --add-port=8121-8124/tcp --permanent
  ```

- æŸ¥çœ‹é˜²ç«å¢™å·²ç»å¼€æ”¾çš„ç«¯å£

  ```bash
  firewall-cmd --zone=public --list-ports
  ```

# ğŸš€ å¼€å¯ cockpit web console æœåŠ¡

- æŸ¥çœ‹æ˜¯å¦å·²ç»å®‰è£… cockpitï¼Œå¦‚æœæ²¡æœ‰å®‰è£…åˆ™å®‰è£…
- è®¾ç½®å¼€æœºå¯ç”¨ cockpit

  ```bash
  systemctl enable --now cockpit.socket
  ```

- cockpit é»˜è®¤ç«¯å£ä¸º 9090ï¼ŒæŸ¥çœ‹é˜²ç«å¢™ç«¯å£æ˜¯å¦å¼€å¯ï¼Œå¦‚æœæ²¡æœ‰åˆ™å¼€å¯
- ä½¿ç”¨æµè§ˆå™¨è®¿é—® `http://192.168.192.168:9090`

# ğŸš€ å»é™¤ Red Hat Insights æç¤ºä¿¡æ¯

æœ‰æ—¶å€™ä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š

```text
This system is not registered to Red Hat Insights. See https://cloud.redhat.com/
To register this system, run: insights-client --register
```

åˆ é™¤ `insights-client` åŒ…å°±å¥½ï¼Œè§ [Rocky Linux å®˜æ–¹è®ºå›][link004]

# ğŸš€ å®‰è£…æ›´é«˜ç‰ˆæœ¬çš„ gcc

> æ‘˜è‡ª [å´æ˜Šåšå®¢][link005]

åœ¨ 8 ç‰ˆæœ¬ä¸­ï¼Œçº¢å¸½ä¹Ÿæä¾›äº†å¼€å‘å·¥å…·åŒ…ç®¡ç† gcc ç‰ˆæœ¬ï¼Œ
`install çš„åŒ…åä» devtoolset-x å˜æˆäº† gcc-toolset-x`ï¼Œ
é€šè¿‡è¯¥æ–¹å¼å‡çº§ gcc å¥½å¤„å°±æ˜¯éšæ—¶å¯ä»¥åˆ‡æ¢ gcc ç‰ˆæœ¬ï¼Œä¸ç ´ååŸæœ‰ gcc ç¯å¢ƒã€‚

æˆªè‡³å½“å‰ gcc-toolset ä»…æ”¯æŒ gcc9ã€gcc10ã€gcc11 ç‰ˆæœ¬

```bash
gcc-toolset-9 å¯¹åº” gcc9.x.x ç‰ˆæœ¬
gcc-toolset-10 å¯¹åº” gcc10.x.x ç‰ˆæœ¬
gcc-toolset-11 å¯¹åº” gcc10.x.x ç‰ˆæœ¬
```

å®‰è£… gcc-toolset-11:

```bash
dnf install gcc-toolset-11
# å®‰è£… gdbserver ï¼ˆå¯é€‰ï¼‰
dnf install gcc-toolset-11-gdb-gdbserver
```

æ¿€æ´» gcc ç‰ˆæœ¬ï¼Œä½¿å…¶ç”Ÿæ•ˆ:

```bash
scl enable gcc-toolset-11 bash
```

æˆ–ï¼š

```bash
source /opt/rh/gcc-toolset-11/enable
```

æ­¤æ—¶é€šè¿‡ `gcc --version` å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼Œgcc ç‰ˆæœ¬å·²ç»å˜æˆ 11.x.xï¼Œ
å€¼å¾—æ³¨æ„çš„æ˜¯è¿™ä»…ä»…åœ¨å½“å‰ bash ç”Ÿæ•ˆï¼Œå¦‚æœéœ€è¦æ°¸ä¹…ç”Ÿæ•ˆï¼Œå¯ä»¥è¯·è‡ªè¡Œæ·»åŠ ç¯å¢ƒå˜é‡ã€‚

ä¸çŸ¥ä¸ºä»€ä¹ˆå®‰è£…åæ˜¾ç¤º gcc ç‰ˆæœ¬ä¸º 11ï¼Œgdb ç‰ˆæœ¬ä¸º 10

# ğŸš€ è§£å†³ VMware å¯åŠ¨æ—¶æç¤º `piix4_smbus 0000:00:07.3: Host SMBus controller not enabled!` é”™è¯¯

```bash
# æŸ¥æ‰¾å‡ºé”™çš„æ¨¡å—
lsmod | grep piix4
# è¿™é‡Œè¾“å‡ºä¸º ic2_piix4
# å°†å…¶åŠ å…¥é»‘åå•ï¼ˆé»‘åå•é»˜è®¤ä¸å­˜åœ¨ï¼‰
echo 'blacklist i2c-piix4' >> /etc/modprobe.d/blacklist.conf
# é‡å¯å³å¯
# æ³¨ï¼šæœ‰äº›æ•™ç¨‹è¯´éœ€è¦é‡æ–°ç”Ÿæˆå†…æ ¸å¼•å¯¼æ–‡ä»¶ï¼Œè¿™é‡Œæµ‹è¯•çš„æ— éœ€é‡æ–°ç”Ÿæˆä¹Ÿå¯ä»¥
# å¤‡æ³¨ä¸€ä¸‹é‡æ–°ç”Ÿæˆå†…æ ¸å¼•å¯¼çš„å‘½ä»¤ï¼š
# é‡æ–°ç”Ÿæˆå†…æ ¸å¼•å¯¼æ–‡ä»¶ä¹‹å‰å»ºè®®åšä¸ªå¤‡ä»½
# å¤‡ä»½:
# cp /boot/initramfs-`uname -r`.img /boot/initramfs-`uname -r`.img.bak
# é‡æ–°ç”Ÿæˆ
# dracut -f /boot/initramfs-`uname -r`.img `uname -r`
```

[link001]: https://sysin.org/blog/rocky-linux-8-install/
[link002]: https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_networking/consistent-network-interface-device-naming_configuring-and-managing-networking
[link003]: ./1010.Linuxå…¨å±€é…ç½®oh-my-zsh.md
[link004]: https://forums.rockylinux.org/t/rocky-8-5-shows-red-hat-insights/4609
[link005]: https://blog.whsir.com/post-6114.html
