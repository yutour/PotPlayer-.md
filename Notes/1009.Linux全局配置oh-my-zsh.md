---
title: "Linux å…¨å±€é…ç½® oh-my-zsh"
---

> æ‘˜è‡ªï¼š[Linux å…¨å±€é…ç½® Zsh + oh-my-zsh][link001]ï¼Œç‚¹å‡»æŸ¥çœ‹æœ€æ–°ç‰ˆã€‚
>
> > ä½œè€…ï¼šgc(at)sysin.orgï¼Œä¸»é¡µï¼šwww.sysin.org

Linux ä¸­ä½¿ç”¨ oh-my-zsh é…ç½® zsh é»˜è®¤ä»…å¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆï¼Œæ–°å»ºæˆ–è€…åˆ‡æ¢ç”¨æˆ·åï¼Œ
ä»ç„¶æ¢å¤åˆ°äº†é»˜è®¤çš„ bashï¼Œéå¸¸ä¸æ–¹ä¾¿ã€‚æœ¬æ–‡æè¿°å…¨å±€é…ç½®çš„æ–¹æ³•ï¼Œ
æ–°ç”¨æˆ·å°†é»˜è®¤ä½¿ç”¨ zsh å¹¶åŠ è½½ç»Ÿä¸€çš„é…ç½®æ–‡ä»¶ã€‚

æœ¬æ–‡å†™ä½œç¯å¢ƒåŸºäº Ubuntu 20.04 å’Œ CentOS 8ï¼Œå…¶ä»–ç‰ˆæœ¬ç±»ä¼¼ï¼Œå¯ä»¥å‚ç…§ã€‚

# ğŸš€ å‡†å¤‡ zsh

- æŸ¥çœ‹å½“å‰ shell

  ```bash
  echo $SHELL
  ```

  è¿”å›ç»“æœ:

  ```bash
  /bin/bash
  ```

- å®‰è£… zsh

  ```bash
  yum -y instal zsh
  # or
  dnf -y install zsh
  ```

- ä¸º root è®¾ç½®é»˜è®¤ shell

  ```bash
  sudo chsh -s /bin/zsh
  ```

- ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®é»˜è®¤ shell

  ```bash
  sudo chsh -s /bin/zsh <username>
  # <username> æ›¿æ¢ä¸ºå®é™…ç”¨æˆ·å
  ```

  è¿”å›ç»“æœå¦‚ä¸‹ï¼Œè¡¨ç¤ºåˆ‡æ¢å®Œæˆï¼ˆä¸‹è½½å®‰è£… oh-my-zsh æˆåŠŸåä¹Ÿä¼šæç¤ºåˆ‡æ¢ï¼‰

  ```bash
  # sudo chsh -s /bin/zsh
  Changing shell for root.
  Shell changed.
  ```

  > åœ¨ CentOS 8 ä¸­å¯èƒ½æŠ¥é”™ Command not foundï¼Œæ‰§è¡Œ sudo dnf install util-linux-user

- å®‰è£… git
  æ‰§è¡Œï¼š

  ```bash
  # CentOS
  yum -y install git
  ```

# ğŸš€ å…¨å±€é…ç½® zsh

> æ³¨æ„ï¼šä»¥ä¸‹å…¨å±€é…ç½®ç›¸å…³å‘½ä»¤éœ€è¦ root æƒé™ï¼Œè¯·åˆ‡æ¢åˆ° root è´¦å·ï¼Œæˆ–è€…ä½¿ç”¨ sudoã€‚

- åˆ‡æ¢æˆ root

  ```bash
  su
  ```

- å…¨å±€å®‰è£… zsh åˆ° /etc ç›®å½•

  ```bash
  git clone https://github.com/robbyrussell/oh-my-zsh.git /etc/oh-my-zsh
  ```

- ä»æ¨¡æ¿æ–‡ä»¶å¤åˆ¶ .zshrc åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶ï¼ˆæ–°ç”¨æˆ·å°†ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶ï¼‰

  ```bash
  cp /etc/oh-my-zsh/templates/zshrc.zsh-template /etc/skel/.zshrc
  ```

- ä¿®æ”¹ on-my-zsh çš„å®‰è£…ç›®å½• `export ZSH=$HOME/.oh-my-zsh` ä¸º `export ZSH=/etc/oh-my-zsh`

  ```bash
  sed -i 's|$HOME/.oh-my-zsh|/etc/oh-my-zsh|g' /etc/skel/.zshrc
  ```

- æ›´æ”¹é»˜è®¤ä¸»é¢˜ï¼ˆæ¨è ysï¼‰

  ç¼–è¾‘ /etc/skel/.zshrc æ–‡ä»¶ä¿®æ”¹ï¼š

  ```bash
  sed -i '/^ZSH_THEME=.*/c ZSH_THEME="ys"' /etc/skel/.zshrc
  ```

- å–æ¶ˆæ¯å‘¨è‡ªåŠ¨æ£€æŸ¥æ›´æ–°

  å–æ¶ˆæ³¨é‡Š .zshrc ä¸­çš„ `# zstyle ':omz:update' mode disabled # disable automatic updates`

  > å–æ¶ˆæ³¨é‡Š ~/.zshrc ä¸­çš„ `# DISABLE_AUTO_UPDATE=â€trueâ€` ï¼ˆæ—§ç‰ˆï¼‰
  >
  > ```bash
  > sed -i 's/^#[ ]\(DISABLE_AUTO_UPDATE="true"\)/\1/' /etc/skel/.zshrc
  > ```

æ‰‹åŠ¨æ›´æ–°ï¼š`omz update`ï¼ˆæ—§ç‰ˆå‘½ä»¤ï¼šupgrade_oh_my_zshï¼‰

- æ–°å¢ç”¨æˆ·å•ç‹¬é…ç½® zsh cache ç›®å½•

  ```bash
  echo "export ZSH_CACHE_DIR=~/.oh-my-zsh/cache" >> /etc/skel/.zshrc
  ```

- åˆ›å»ºæ–°ç”¨æˆ·é…ç½®æ–‡ä»¶ä¸Šè¿°å˜é‡å®šä¹‰çš„ç¼“å­˜ç›®å½•

  ```bash
  mkdir -p /etc/skel/.oh-my-zsh/cache
  ```

  å‚è€ƒ [adduser][link002]ï¼ˆ11.2.3. Initial environment: `/etc/skel`ï¼‰

- é…ç½® ll åˆ«åï¼ˆå¯é€‰ï¼‰

  ```bash
  echo 'alias ll="ls -lahF --color --time-style=long-iso"' >> /etc/skel/.zshrc
  ```

# ğŸš€ å…¨å±€é…ç½®æ’ä»¶

å…¨å±€å®‰è£…æ’ä»¶ï¼ˆå®‰è£…åˆ° /etc/oh-my-zsh/custom/plugins/ï¼‰

**zsh-autosuggestionsï¼šä½œç”¨æ˜¯æ ¹æ®å†å²è¾“å…¥å‘½ä»¤çš„è®°å½•å³æ—¶çš„æç¤ºï¼Œç„¶åæŒ‰é”®ç›˜ â†’ å³å¯è¡¥å…¨ã€‚**

(ä¸ªäººä¸æ¨èè¿™ä¸ªæ’ä»¶ã€‚oh-my-zsh é»˜è®¤å®‰è£…ä¹Ÿè‡ªå¸¦å¼ºå¤§çš„å‘½ä»¤è¡¥å…¨åŠŸèƒ½ã€‚)

```bash
git clone https://github.com/zsh-users/zsh-autosuggestions.git /etc/oh-my-zsh/custom/plugins/zsh-autosuggestions
```

ç¼–è¾‘ /etc/skel/.zshrcï¼Œæ‰¾åˆ° plugins=(git) è¿™ä¸€è¡Œï¼Œä¿®æ”¹ä¸ºï¼š

plugins=(git zsh-autosuggestions)

**zsh-syntax-highlightingï¼šè¯­æ³•é«˜äº®æ’ä»¶ã€‚**

ä½œç”¨ï¼šå‘½ä»¤é”™è¯¯ä¼šæ˜¾ç¤ºçº¢è‰²ï¼Œç›´åˆ°ä½ è¾“å…¥æ­£ç¡®æ‰ä¼šå˜ç»¿è‰²ï¼Œå¦å¤–è·¯å¾„æ­£ç¡®ä¼šæ˜¾ç¤ºä¸‹åˆ’çº¿ã€‚

å®‰è£…ï¼š

```bash
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git /etc/oh-my-zsh/custom/plugins/zsh-syntax-highlighting
```

é…ç½®å¯ç”¨æ’ä»¶ï¼š

ç¼–è¾‘ `/etc/skel/.zshrc`
ä»¥ä¸‹éƒ¨åˆ†åŠ å…¥æ’ä»¶çš„åå­—
`plugins=([pluginsâ€¦] zsh-syntax-highlighting)`

å¿«é€Ÿä¿®æ”¹ï¼š

```bash
sed -i '/^plugins=.*/c plugins=(git zsh-syntax-highlighting)' /etc/skel/.zshrc
```

å¢å¼ºçš„å®æ—¶è‡ªåŠ¨å‘½ä»¤è¡¥å…¨æ’ä»¶ï¼š[Incremental completion on zsh][link003]

ï¼ˆè¯¥æ’ä»¶å¯¹æ€§èƒ½ä¼¼ä¹æœ‰ä¸€ç‚¹ç‚¹å½±å“ï¼Œè¯·æ ¹æ®éœ€è¦å¯ç”¨ã€‚ï¼‰

ä½œç”¨å¦‚å›¾ï¼š

![å¢å¼ºçš„å®æ—¶è‡ªåŠ¨å‘½ä»¤è¡¥å…¨æ’ä»¶ï¼šIncremental completion on zsh][link004]

```bash
mkdir /etc/oh-my-zsh/custom/plugins/incr
curl -fsSL https://mimosa-pudica.net/src/incr-0.2.zsh -o /etc/oh-my-zsh/custom/plugins/incr/incr.zsh
echo "source /etc/oh-my-zsh/custom/plugins/incr/incr.zsh" >> /etc/skel/.zshrc
```

# ğŸš€ ä½¿ç”¨ç”¨æˆ·é…ç½®æ–‡ä»¶

- æ”¹å˜æ–°ç”¨æˆ·çš„é»˜è®¤ shellï¼ˆå¯é€‰ï¼‰

  ```bash
  vi /etc/default/useradd
  ```

  å°† SHELL= \* (æ¯”å¦‚ SHELL=/bin/sh) æ”¹æˆ SHELL=/bin/zsh

  ä¿®æ”¹åï¼Œä½¿ç”¨ `useradd` å‘½ä»¤æ— éœ€ `-s /bin/zsh`ï¼Œç”¨æˆ·é»˜è®¤ä½¿ç”¨ `zsh`ï¼Œ
  å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä¿®æ”¹æ­¤é¡¹ï¼Œ`useradd` å‘½ä»¤ç»§ç»­è¿½åŠ  `-s /bin/zsh` å‚æ•°ã€‚

  æ–°ç”¨æˆ·ç™»å½•åï¼Œå°†è‡ªåŠ¨å¤åˆ¶ .zshrc å’Œä¸Šè¿° cache ç›®å½•åˆ°ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼Œå¹¶è‡ªåŠ¨åŠ è½½
  zsh é…ç½®ã€‚

- é’ˆå¯¹ç°æœ‰ç”¨æˆ·
  ç›´æ¥å¤åˆ¶ /etc/skel/.zshrc åˆ° ~/

  ```bash
  cp /etc/skel/.zshrc ~/.zshrc
  mkdir -p ~/.oh-my-zsh/cache
  source ~/.zshrc
  ```

**å‚è€ƒï¼šåˆ›å»ºç®¡ç†å‘˜è´¦å·çš„æ­£ç¡®å§¿åŠ¿ï¼ˆé»˜è®¤é…ç½®ï¼‰ã€‚**

åœ¨ visudo (/etc/sudoersï¼‰é»˜è®¤é…ç½®ä¸‹ï¼Œåˆ›å»ºç®¡ç†å‘˜è´¦å·çš„å‘½ä»¤å¦‚ä¸‹ï¼š

- CentOSï¼š

  ```bash
  useradd -m -s /bin/zsh -G wheel user1  #user1 ä¸ºç”¨æˆ·å
  passwd user1  #ä¸º user1 è®¾ç½®å¯†ç 
  ```

- Ubuntuï¼š

  ```bash
  useradd -m -s /bin/zsh -G sudo user1  #user1 ä¸ºç”¨æˆ·å
  passwd user1  #ä¸º user1 è®¾ç½®å¯†ç 
  ```

> å¤‡æ³¨ï¼š
>
> -m åˆ›å»ºåŒå home ç›®å½•
>
> -s æŒ‡å®š shell
>
> -G ä¿®æ”¹é™„åŠ å±ç»„

[link001]: https://sysin.org/blog/linux-zsh-all/
[link002]: https://tldp.org/LDP/sag/html/adduser.html
[link003]: https://mimosa-pudica.net/zsh-incremental.html
[link004]: ./Atta/Linuxå…¨å±€é…ç½®oh-my-zsh/001.gif
